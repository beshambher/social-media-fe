<div class="row">
    <div class="col-md-3">
        <app-left-sidebar></app-left-sidebar>
    </div>
    <div class="col-md-6">
        <div class="card rounded-3 border shadow-lg">
            <div class="card-body">
                <form [formGroup]="postForm">
                    <div class="form-floating">
                        <textarea formControlName="body" class="form-control h-auto" placeholder="Something's on your mind?" id="postarea" rows="3"></textarea>
                        <label for="postarea">Something's on your mind?</label>
                    </div>
                    <button type="button" class="btn btn-sm btn-primary mt-2" [disabled]="!postForm.valid" (click)="postStatus()">
                        <i class="fas fa-pencil-alt"></i> Post
                    </button>
                </form>
            </div>
        </div>
        <ng-container *ngFor="let post of posts.content">
            <div class="card mt-2 rounded-3 border shadow-lg">
                <div class="row g-0">
                    <div class="col-2 p-1 p-md-2">
                        <img [src]="post.user.avatar" class="img-thumbnail rounded-circle border-0" alt="{{post.user.username}}"/>
                    </div>
                    <div class="col-9 my-auto">
                        <h6 class="mb-0">{{post.user.username}}</h6>
                        <small class="text-muted">{{post.createdAt | date:'MMM d, y, h:mm a'}}</small>
                    </div>
                    <div class="col-1 my-auto" *ngIf="user.username==post.user.username">
                        <div class="dropdown">
                            <button class="btn btn-sm dropdown-toggle" type="button" id="dropdownMenu2" 
                                data-bs-toggle="dropdown" aria-expanded="false">
                            </button>
                            <ul class="dropdown-menu rounded-3 shadow mw-unset" aria-labelledby="dropdownMenu2">
                              <li>
                                  <button class="dropdown-item btn-sm" type="button" (click)="editPost(post)"><i class="fas fa-pencil-alt"></i> Edit</button>
                              </li>
                              <li>
                                <button class="dropdown-item btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#deleteModal" [attr.data-bs-id]="post.id">
                                    <i class="fas fa-trash text-danger"></i> Delete
                                </button>
                              </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card-body pt-2">
                    <p *ngIf="editPostId!=post.id; else editPostFormBlock" class="card-text">{{post.body}}</p>
                    <ng-template #editPostFormBlock>
                        <app-text-area [editForm]="editPostForm" [editFormData]="editPostFormData" (update)="editPostStatus($event, post.id)" (cancel)="editPostId=''"></app-text-area>
                    </ng-template>
                    <button class="btn btn-sm btn-primary me-2" (click)="togglePostLike(post.id)"><i class="fas fa-thumbs-up"></i> Like</button>
                    <button class="btn btn-sm btn-primary" (click)="togglePostComment(post.id)"><i class="fas fa-comment"></i> Comment</button>
                    <div class="text-muted d-inline float-end">
                        <small class="me-1">{{post.likes | itos}} like{{post.likes==1?'':'s'}}</small>
                        <small>{{post.commentsCount | itos}} comment{{post.commentsCount==1?'':'s'}}</small>
                    </div>
                    <app-comment *ngIf="editPostCommentId==post.id" [post]="post" (success)="updateCommentCount(post.id)"></app-comment>
                </div>
            </div>
        </ng-container>
        <!-- virtual infinit pagination -->
        <small class="d-block text-center mt-2" *ngIf="posts && !posts.last" >
            <button class="btn btn-sm btn-outline-primary" (click)="loadMore()">See More Posts</button>
        </small>
        <!-- delete confirm modal -->
        <app-delete-modal [deleteData]="{id: 'deleteModal', item: 'post'}" (showBsModal)="deletePost($event)" (delete)="deletePostStatus()"></app-delete-modal>
        <div class="mt-2"></div>
    </div>
    <div class="col-md-3">
        <app-right-sidebar></app-right-sidebar>
    </div>
</div>